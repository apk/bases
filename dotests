#!/bin/sh
set -ex

progs="e64 rot13 hex2bin bin2hex inv94 carray"
(
    echo '# Generated by dotests...'
    echo 'BINDIR=.bin'
    echo "all ::"
    for i in $progs; do
cat <<EOF

all :: \$(BINDIR)/$i

\$(BINDIR)/$i : $i.c common.c
	mkdir -p \$(BINDIR)
	gcc -o \$(BINDIR)/$i $i.c
EOF
    done
) >Makefile
bindir=.bin
make BINDIR=$bindir

teste64 () {
    echo "$1"
    res="`/bin/echo -n "$1" | $bindir/e64`" #` <- Comment for happy emacs mode
    if test "$2" = "$res"; then
	res="`$bindir/e64 -c "$1"`" #` <- Comment for happy emacs mode
	if test "$2" = "$res"; then
	    /bin/echo -n "$1" >.tmp
	    res="`$bindir/e64 .tmp`" #` <- Comment for happy emacs mode
	    if test "$2" = "$res"; then
		rm -f .tmp
		true
	    else
		rm -f .tmp
		echo "'$res' isn't '$2' on '$1' (file)"
		false
	    fi
	else
	    echo "'$res' isn't '$2' on '$1' (-c)"
	    false
	fi
    else
	echo "'$res' isn't '$2' on '$1' (stdin)"
	false
    fi
}


teste64 "sure."  "c3VyZS4="
teste64 "sure"   "c3VyZQ=="
teste64 "sur"    "c3Vy"
teste64 "su"     "c3U="

teste64 "leasure." "bGVhc3VyZS4="
teste64 "easure." "ZWFzdXJlLg=="
teste64 "asure." "YXN1cmUu"
teste64 "sure." "c3VyZS4="
